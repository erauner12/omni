# cluster-template-home.yaml
kind: Cluster
name: erauner-home                       # Cluster name in Omni
talos:
  version: v1.10.4               # same as Ken – change if you like
kubernetes:
  version: 1.31.5                # latest patch in the supported minor
features:
  enableWorkloadProxy: true      # SaaS Omni feature – leave on
patches:
  - name: cluster-base
    file: ./patches/cluster.yaml   # relative path because repo will be synced
  # Add cert patches here later if you decide to keep them

---
kind: ControlPlane
machines:
  - e58acc82-cc4c-d949-b369-bc3898683580   # Beelink CP
patches:
  - name: controlplane-base
    file: ./patches/controlplane.yaml
  - name: machine-hostdns         # comment out if you dropped the file
    file: ./patches/machine-hostdns.yaml
  - name: kubelet
    file: ./patches/machine-kubelet.yaml
  # (Add machine-certs patch here only if you kept it)
  - name: static-ip
    inline:
      machine:
        network:
          interfaces:
            - interface: eth0
              dhcp: false
              addresses:
                - 192.168.1.193/24    # << static for controlplane1
              gateway: 192.168.1.1
              nameservers:
                - 192.168.1.1
---
kind: Workers
name: workers
machines:
  - 4913bb46-7cd8-2048-84c7-a8595f97a48c   # old CP becomes worker
  - 30467aa4-b8a4-2e43-8591-a8595f97a43c   # worker-1 (offline right now)
  - d3945f76-fb6b-c244-9ca3-a8595f9b4f7e   # worker-2 (offline)
patches:
  - name: worker-base
    file: ./patches/worker.yaml
  - name: machine-hostdns         # comment out if you dropped it
    file: ./patches/machine-hostdns.yaml
  - name: kubelet
    file: ./patches/machine-kubelet.yaml

#######################################################################
# ─── PER-NODE HOSTNAME + STATIC IP PATCHES ──────────────────────────
#######################################################################
---
kind: Machine                           # controlplane1 (already active)
name: e58acc82-cc4c-d949-b369-bc3898683580
patches:
  - name: set-nodename
    inline:
      machine:
        network:
          hostname: "controlplane1"
          interfaces:
            - interface: eth0
              dhcp: false
              addresses: [192.168.1.193/24]
              gateway: 192.168.1.1
              nameservers: [192.168.1.1]

---
kind: Machine                           # worker1  → 192.168.1.194
name: 30467aa4-b8a4-2e43-8591-a8595f97a43c
patches:
  - name: set-nodename
    inline:
      machine:
        network:
          hostname: "worker1"
          interfaces:
            - interface: eth0
              dhcp: false
              addresses: [192.168.1.194/24]
              gateway: 192.168.1.1
              nameservers: [192.168.1.1]

---
kind: Machine                           # worker2  → 192.168.1.195
name: 4913bb46-7cd8-2048-84c7-a8595f97a48c
patches:
  - name: set-nodename
    inline:
      machine:
        network:
          hostname: "worker2"
          interfaces:
            - interface: eth0
              dhcp: false
              addresses: [192.168.1.195/24]
              gateway: 192.168.1.1
              nameservers: [192.168.1.1]

---
kind: Machine                           # worker3  → 192.168.1.196
name: d3945f76-fb6b-c244-9ca3-a8595f9b4f7e
patches:
  - name: set-nodename
    inline:
      machine:
        network:
          hostname: "worker3"
          interfaces:
            - interface: eth0
              dhcp: false
              addresses: [192.168.1.196/24]
              gateway: 192.168.1.1
              nameservers: [192.168.1.1]